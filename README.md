# openslack的运维目标
1) 为整个数据中心提供分布式调度与协调功能，统一协调各类资源，实现数据中心级的弹性伸缩能力。
2) 提供一个高效率、可靠、安全的管理数据中心的平台，确保各类资源随着应用的需求动态调度，同时简化应用程序的开发、部署难度

## 基础架构
1) 基础平台为openstack，搭建虚拟环境

2) dokcer的应用容器化，以及docker本地仓库

3) Mesos做集群的调度和docker、etcd、haproxy等的部署,集群用ZK确保一致性和高可用

4) jekins做持续的镜像打包、上传等构建和上线

5) git分布式的版本控制系统

6) 监控系统负责日志和告警，级状态看板

7) 业务请求通过HAProxy分发到Docker容器中的应用。

8) Confd监测到Etcd中相关的服务变化，Confd就会根据变化的情况更新Haproxy的cfg配置文件并执行重新加载命令，使相关变化生效，同样当容器停止时也会触发Haproxy更新cfg配置文件并重新加载，达到动态服务注册。

9) cmdb配置基本的信息

10）Marathon通过Mesos启动Docker容器时，Marathon将容器启动信息通知Etcd服务。Etcd服务将已经启动容器信息注册到Etcd键值库中。Marathon会监听容器的状态和恢复能力，

11) Chronos是针对分布式批处理应用提供任务调度，比如定期处理日志或者定期调Hadoop等离线任务。

12）文件存储，可以是HDFS或者CEPH

13) 进程间通信

## 功能包含
1) DCOS Dashboard

2) 资源管理模块：服务目录管理、规则管理、CMDB信息；

3) 监控管理模块：监控数据采集、日志管理、告警管理和事件管理；

4) 弹性扩缩容调度模块：基于CPU使用率、内存使用率、服务并发数、响应时间等容量数据，通过定制的调度算法实现服务的自动弹性扩缩容；

5) 统一日志中心：采用Elasticsearch、Logstash、Graylog构建，实现对容器日志的统一存储及检索；

6) 鉴权模块：用户管理、用户组管理、权限策略管理和统一认证接口；

7) 持续集成平台：镜像构建、集成测试、流程管理和上线管理。


## 应用封装
应用封装采用Docker做为应用容器引擎，Docker是轻量级虚拟化技术，它在标准的LXC之上融合AUFS分层镜像管理机制，并以应用为单元进行“集装封箱”，实现的相关应用封装能力如下：

1) Docker容器技术可以部署应用到可移植的的容器中，这些容器独立于硬件、语言、框架、打包系统，帮助实现持续集成与部署。一个标准的Docker容器包含一个软件组件及其所有的依赖 ，包括二进制文件、库、配置文件、脚本等。

2) Docker容器可以封装任何有效负载，可以在任何服务器之间进行一致性运行。开发者构建的应用只需一次构建即可多平台运行。

## 资源调度
使用Mesos作为资源调度框架，其核心工作原理如下：
1) Mesos Master负责将资源分配给各个框架，而各个框架的Scheduler进一步将资源分配给其内部的各个应用程序。

2) Mesos和不同类型的Framework通信，每种Framework通过各自的Scheculer发起task给Mesos slave，对Mesos集群进行调度管理。

3) Framework的Executor执行其Scheculer发起的task。

## 任务调度
由于Mesos仅负责分布式集群资源分配，不负责任务调度。因此，需引入Marathon来基于Mesos来做任务调度，Marathon用来调度长期运行的服务。Mesos集群可以混合运行不同类型的任务 ，其任务调度示意图如下：

1) Marathon基于Mesos的任务调度为动态调度，即每个任务在执行之前是对具体服务器和绑定端口均为未知。

2) Mesos集群上混合运行着包括Marathon在内各种调度框架的任务，当某台服务器宕机以后，Marathon可把任务迁移到其他服务器上，实现容错。

## 服务注册及引流
通过Haproxy、Confd、Etcd配合实现数据中心应用的动态服务注册与引流，其中Etcd是一个高可用的键值存储系统，主要用于共享配置和服务发现。HAProxy提供高可用性、负载均衡的解决方案。其主要的架构流程如下：

1) Marathon通过Mesos启动Docker容器时，Marathon将容器启动信息通知Etcd服务。

2) Etcd服务将已经启动容器信息注册到Etcd键值库中。

3) Confd监测到Etcd中相关的服务变化，Confd就会根据变化的情况更新Haproxy的cfg配置文件并执行重新加载命令，使相关变化生效，同样当容器停止时也会触发Haproxy更新cfg配置文件并重新加载，达到动态服务注册。

4) 业务请求通过HAProxy分发到Docker容器中的应用。

## 自动弹性扩缩容
Marathon的扩缩容默认只能根据用户需要进行手动调整，实现基于并发数、响应时间、CPU和内存使用率等容量指标进行自动弹性扩缩容调度的模块。结合前面提到的HAProxy、Confd、Etcd动态服务注册和引流能力，实现应用的自动弹性扩缩容能力。